kind: serving
metadata:
  name: sentiment-analysis-serving
  tag: ''
  hash: 5812b3b3d268c51a3d198a506194af00feb962f0
  project: ''
  labels:
    author: avia
    framework: pytorch
  categories:
  - model-serving
  - machine-learning
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  build:
    commands:
    - python -m pip install transformers==3.0.2
    code_origin: https://aviaIguazio@github.com/aviaIguazio/functions.git#70f74c0a73a53cd7b3818fecca9e587a16fa9197:/Users/aviasulin/PycharmProjects/mlrun/functions/sentiment_analysis_serving/sentiment_analysis_serving.py
    origin_filename: /Users/aviasulin/PycharmProjects/mlrun/functions/sentiment_analysis_serving/sentiment_analysis_serving.py
  description: BERT based sentiment classification model
  default_handler: handler
  disable_auto_mount: false
  env: []
  priority_class_name: ''
  preemption_mode: prevent
  min_replicas: 1
  max_replicas: 4
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      name: sentiment-analysis-serving
      labels: {}
      annotations:
        nuclio.io/generated_by: function generated from /Users/aviasulin/PycharmProjects/mlrun/functions/sentiment_analysis_serving/sentiment_analysis_serving.py
    spec:
      runtime: python
      handler: sentiment_analysis_serving:handler
      env: []
      volumes: []
      build:
        commands: []
        noBaseImagesPull: true
        functionSourceCode: aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgpmcm9tIHRyYW5zZm9ybWVycyBpbXBvcnQgQmVydE1vZGVsLCBCZXJ0VG9rZW5pemVyCmltcG9ydCBtbHJ1bgoKUFJFVFJBSU5FRF9NT0RFTCA9ICdiZXJ0LWJhc2UtY2FzZWQnCnRva2VuaXplciA9IEJlcnRUb2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKCdiZXJ0LWJhc2UtY2FzZWQnKQoKCmNsYXNzIEJlcnRTZW50aW1lbnRDbGFzc2lmaWVyKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbl9jbGFzc2VzKToKICAgICAgICBzdXBlcihCZXJ0U2VudGltZW50Q2xhc3NpZmllciwgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYuYmVydCA9IEJlcnRNb2RlbC5mcm9tX3ByZXRyYWluZWQoUFJFVFJBSU5FRF9NT0RFTCkKICAgICAgICBzZWxmLmRyb3BvdXQgPSBubi5Ecm9wb3V0KHA9MC4yKQogICAgICAgIHNlbGYub3V0X2xpbmVhciA9IG5uLkxpbmVhcihzZWxmLmJlcnQuY29uZmlnLmhpZGRlbl9zaXplLCBuX2NsYXNzZXMpCiAgICAgICAgc2VsZi5zb2Z0bWF4ID0gbm4uU29mdG1heChkaW09MSkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCBpbnB1dF9pZHMsIGF0dGVudGlvbl9tYXNrKToKICAgICAgICBfLCBwb29sZWRfb3V0ID0gc2VsZi5iZXJ0KAogICAgICAgICAgICBpbnB1dF9pZHM9aW5wdXRfaWRzLAogICAgICAgICAgICBhdHRlbnRpb25fbWFzaz1hdHRlbnRpb25fbWFzawogICAgICAgICkKICAgICAgICBvdXQgPSBzZWxmLmRyb3BvdXQocG9vbGVkX291dCkKICAgICAgICBvdXQgPSBzZWxmLm91dF9saW5lYXIob3V0KQogICAgICAgIHJldHVybiBzZWxmLnNvZnRtYXgob3V0KQoKCmNsYXNzIFNlbnRpbWVudENsYXNzaWZpZXJTZXJ2aW5nKG1scnVuLnNlcnZpbmcuVjJNb2RlbFNlcnZlcik6CiAgICBkZWYgbG9hZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBsb2FkIGJlcnQgbW9kZWwgaW50byBjbGFzcwogICAgICAgICIiIgogICAgICAgIG1vZGVsX2ZpbGUsIF8gPSBzZWxmLmdldF9tb2RlbCgnLnB0JykKICAgICAgICBkZXZpY2UgPSB0b3JjaC5kZXZpY2UoJ2N1ZGE6MCcpIGlmIHRvcmNoLmN1ZGEuaXNfYXZhaWxhYmxlKCkgZWxzZSB0b3JjaC5kZXZpY2UoJ2NwdScpCiAgICAgICAgbW9kZWwgPSBCZXJ0U2VudGltZW50Q2xhc3NpZmllcihuX2NsYXNzZXM9MykKICAgICAgICBtb2RlbC5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZChtb2RlbF9maWxlLCBtYXBfbG9jYXRpb249ZGV2aWNlKSkKICAgICAgICBtb2RlbC5ldmFsKCkKICAgICAgICBzZWxmLm1vZGVsID0gbW9kZWwKCiAgICBkZWYgcHJlZGljdChzZWxmLCBib2R5KToKICAgICAgICAiIiIKICAgICAgICBwcmVkaWN0IGZ1bmN0aW9uCiAgICAgICAgOnBhcmFtIGJvZHk6IHNldCBvZiBpbnB1dHMgZm9yIGJlcnQgbW9kZWwgdG8gcHJlZGljdCBmcm9tCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbnN0YW5jZXMgPSBib2R5WydpbnB1dHMnXQogICAgICAgICAgICBzZWxmLmNvbnRleHQubG9nZ2VyLmluZm8oImlucHV0czoge30iLmZvcm1hdChpbnN0YW5jZXMpKQogICAgICAgICAgICBlbmMgPSB0b2tlbml6ZXIuYmF0Y2hfZW5jb2RlX3BsdXMoaW5zdGFuY2VzLCByZXR1cm5fdGVuc29ycz0ncHQnLCBwYWRfdG9fbWF4X2xlbmd0aD1UcnVlKQogICAgICAgICAgICBvdXRwdXRzID0gc2VsZi5tb2RlbChpbnB1dF9pZHM9ZW5jWydpbnB1dF9pZHMnXSwgYXR0ZW50aW9uX21hc2s9ZW5jWydhdHRlbnRpb25fbWFzayddKQogICAgICAgICAgICBfLCBwcmVkaWN0cyA9IHRvcmNoLm1heChvdXRwdXRzLCBkaW09MSkKICAgICAgICAgICAgcHJlZGljdGlvbl9yZXR1cm4gPSB7J3ByZWRpY3Rpb25zJzogcHJlZGljdHMuY3B1KCkudG9saXN0KCl9CiAgICAgICAgICAgIGlmICJtZXRhX2RhdGEiIGluIGJvZHk6CiAgICAgICAgICAgICAgICBwcmVkaWN0aW9uX3JldHVyblsnbWV0YV9kYXRhJ10gPSBib2R5WydtZXRhX2RhdGEnXQogICAgICAgICAgICBzZWxmLmNvbnRleHQubG9nZ2VyLmluZm8oInByZWRpY3Rpb246IHt9Ii5mb3JtYXQocHJlZGljdGlvbl9yZXR1cm4pKQogICAgICAgICAgICByZXR1cm4gcHJlZGljdGlvbl9yZXR1cm4KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiRmFpbGVkIHRvIHByZWRpY3QgJXMiICUgZSkKCmZyb20gbWxydW4ucnVudGltZXMgaW1wb3J0IG51Y2xpb19pbml0X2hvb2sKZGVmIGluaXRfY29udGV4dChjb250ZXh0KToKICAgIG51Y2xpb19pbml0X2hvb2soY29udGV4dCwgZ2xvYmFscygpLCAnc2VydmluZ192MicpCgpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6CiAgICByZXR1cm4gY29udGV4dC5tbHJ1bl9oYW5kbGVyKGNvbnRleHQsIGV2ZW50KQo=
  source: ''
  function_kind: serving_v2
  secret_sources: []
  affinity: null
  tolerations: null
verbose: false
