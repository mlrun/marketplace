
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>PII Recognizer</title>
<!-- Loaded before other Sphinx assets -->
<link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="../../../_static/togglebutton.css" rel="stylesheet" type="text/css">
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<script data-url_root="./" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script>
<script src="../../../_static/underscore.js"></script>
<script src="../../../_static/doctools.js"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../../../_static/togglebutton.js"></script>
<script src="../../../_static/scripts/sphinx-book-theme.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<link href="genindex.html" rel="index" title="Index">
<link href="search.html" rel="search" title="Search">
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint single-page" id="site-navigation">
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
</div>
<div class="header-article__right">
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<div class="menu-dropdown menu-dropdown-repository-buttons">
<button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
<i class="fab fa-github"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/mlrun/marketplace" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="headerbtn__text-container">repository</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/mlrun/marketplace/issues/new?title=Issue%20on%20page%20%2Fpii_recognizer_example.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
<span class="headerbtn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="headerbtn__text-container">open issue</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/mlrun/marketplace/edit/master/docs/pii_recognizer_example.ipynb" title="Edit this page">
<span class="headerbtn__icon-container">
<i class="fas fa-pencil-alt"></i>
</span>
<span class="headerbtn__text-container">suggest edit</span>
</a>
</li>
</ul>
</div>
</div>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../src/pii_recognizer.ipynb" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#documentation">
   1. Documentation
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#parameters">
     1.1. Parameters:
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#outputs">
     1.2. Outputs:
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#results">
   2. Results
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#end-to-end-demo">
   3. End-to-end Demo
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#recognition-configurations">
     3.1. Recognition configurations
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#masking-configurations">
     3.2. Masking configurations
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#output-configurations">
     3.3 Output configurations
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>PII Recognizer</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#documentation">
   1. Documentation
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#parameters">
     1.1. Parameters:
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#outputs">
     1.2. Outputs:
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#results">
   2. Results
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#end-to-end-demo">
   3. End-to-end Demo
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#recognition-configurations">
     3.1. Recognition configurations
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#masking-configurations">
     3.2. Masking configurations
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#output-configurations">
     3.3 Output configurations
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<section id="pii-recognizer">
<h1>PII Recognizer<a class="headerlink" href="#pii-recognizer" title="Permalink to this headline">#</a></h1>
<p>A function to detect pii data and anonymize the pii entity in the text.</p>
<p>In this notebook we will go over the function’s docs and outputs and see an end-to-end example of running it.</p>
<ol class="arabic simple">
<li><p><span class="xref myst">Documentation</span></p></li>
<li><p><span class="xref myst">Results</span></p></li>
<li><p><span class="xref myst">End-to-end Demo</span></p></li>
</ol>
<p><a id="chapter1"></a></p>
<section id="documentation">
<h2>1. Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">#</a></h2>
<p>The function receive a directory path with all the text files in it. It walk through the directory, get all the text file. Then it detect the pii entity inside of the text file, apply the operator on the entity. Generate the html file with all pii entity highlighted. Generate the json report has the explaination of the process.</p>
<section id="parameters">
<h3>1.1. Parameters:<a class="headerlink" href="#parameters" title="Permalink to this headline">#</a></h3>
<ul>
<li><p><strong>context</strong>: <code class="docutils literal notranslate"><span class="pre">mlrun.MLClientCtx</span></code></p>
<p>The MLRun context</p>
</li>
<li><p><strong>input_path</strong>: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<p>The input directory with all the text files</p>
</li>
<li><p><strong>output_path</strong>: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<p>The directory that is used to store the anonymized text files. it is also used for mlrun to log the artifact as zip file</p>
</li>
<li><p><strong>output_suffix</strong>: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<p>The suffix will added to the input file. for example if the input text file is pii.txt, if output_suffix is “anonymized”, the output file would be pii_anonymized.txt</p>
</li>
<li><p><strong>html_key</strong>: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<p>The artifact name of the html file</p>
</li>
<li><p><strong>entities</strong>: <code class="docutils literal notranslate"><span class="pre">List[str]</span></code></p>
<p>The list of the entities to recognize. Please make sure the model you choose can recognize the entities.</p>
</li>
<li><p><strong>entity_operator_map</strong>: <code class="docutils literal notranslate"><span class="pre">List[str]</span></code>
For different entity, we can apply different operator. Now supports Keep, Mask, Replace, Redact, Hash</p>
<pre>
   entity_operator_map = {
      "PERSON": ("keep", {}),
      "EMAIL": ("mask", {"masking_char": "#", "chars_to_mask": 5, "from_end": False}),
      "PHONE": ("hash", {}),
      "LOCATION": ("redact", {}),
      "ORGANIZATION": ("replace", {"new_value": "Company XYZ"})
      }
   </pre>
<p>In this example:</p>
<ul class="simple">
<li><p>“PERSON” entities are kept as they are using the “keep” operator.</p></li>
<li><p>“EMAIL_ADDRESS” entities are masked with the “#” character, masking the first five characters.</p></li>
<li><p>“PHONE_NUMBER” entities are replaced with their hashed value using the “hash” operator.</p></li>
<li><p>“LOCATION” entities are completely removed using the “redact” operator.</p></li>
<li><p>“ORGANIZATION” entities are replaced with the string “Company XYZ” using the “replace” operator.</p></li>
</ul>
</li>
<li><p><strong>model</strong>: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<ul class="simple">
<li><p>“whole”, “spacy”, “pattern”, “flair”. The default is “whole”.</p></li>
</ul>
<p>For each model, it can detect some entities. The “whole” model is combined all three models together. It can detect all the entities list below.</p>
<ul class="simple">
<li><p>“spacy” : [“LOCATION”, “PERSON”,”NRP”,”ORGANIZATION”,”DATE_TIME”]</p></li>
<li><p>“pattern”: [“CREDIT_CARD”, “SSN”, “PHONE”, “EMAIL”]</p></li>
<li><p>“flair”: [ “LOCATION”,
“PERSON”,
“NRP”,
“GPE”,
“ORGANIZATION”,
“MAC_ADDRESS”,
“US_BANK_NUMBER”,
“IMEI”,
“TITLE”,
“LICENSE_PLATE”,
“US_PASSPORT”,
“CURRENCY”,
“ROUTING_NUMBER”,
“US_ITIN”,
“US_BANK_NUMBER”,
“US_DRIVER_LICENSE”,
“AGE”,
“PASSWORD”,
“SWIFT_CODE”
]</p></li>
</ul>
</li>
<li><p><strong>score_threshold</strong>:</p>
<p>Minimum confidence value, the default is 0 to align with presidio.AnalyzerEngine</p>
</li>
<li><p><strong>generate_json_rpt</strong>:</p>
<p>Whether to generate the json report of the explaination</p>
</li>
<li><p><strong>generate_html_rpt</strong>:</p>
<p>Whether to generate the html with highlighted pii entities or not</p>
</li>
<li><p><strong>is_full_text</strong>:</p>
<p>Whether to return the full text or just the sentences with pii entities.</p>
</li>
<li><p><strong>is_full_html</strong>: <code class="docutils literal notranslate"><span class="pre">bool</span></code></p>
<p>Whether to return the full html or just the annotated html</p>
</li>
<li><p><strong>is_full_report</strong>: <code class="docutils literal notranslate"><span class="pre">bool</span></code></p>
<p>Whether to return the full json report or just the score and start, end index</p>
</li>
</ul>
</section>
<section id="outputs">
<h3>1.2. Outputs:<a class="headerlink" href="#outputs" title="Permalink to this headline">#</a></h3>
<p>There are two outputs of this function.</p>
<ul>
<li><p><strong>output_path</strong>: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<p>The directory stored all the anonymized text files</p>
</li>
<li><p><strong>rpt_json</strong>: <code class="docutils literal notranslate"><span class="pre">dict</span></code></p>
<p>A dict of reporting to explain how does the model detect the pii entity</p>
</li>
<li><p><strong>errors</strong> : <code class="docutils literal notranslate"><span class="pre">dict</span></code>
A dict of errors when processing the text files if any</p></li>
</ul>
<p><a id="chapter2"></a></p>
</section>
</section>
<section id="results">
<h2>2. Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h2>
<p>The result of the function looks like the following:</p>
<p>For example if the input string is</p>
<p><code class="docutils literal notranslate"><span class="pre">John</span> <span class="pre">Doe</span> <span class="pre">'s</span> <span class="pre">ssn</span> <span class="pre">is</span> <span class="pre">182838483,</span> <span class="pre">connect</span> <span class="pre">john</span> <span class="pre">doe</span> <span class="pre">with</span> <span class="pre">john_doe@gmail.com</span> <span class="pre">or</span> <span class="pre">6288389029,</span> <span class="pre">he</span> <span class="pre">can</span> <span class="pre">pay</span> <span class="pre">you</span> <span class="pre">with</span> <span class="pre">41482929939393</span></code></p>
<p>The anonymized_text is</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;PERSON&gt;'s</span> <span class="pre">&lt;ORGANIZATION&gt;</span> <span class="pre">is</span> <span class="pre">&lt;SSN&gt;,</span> <span class="pre">connect</span> <span class="pre">&lt;PERSON&gt;</span> <span class="pre">with</span> <span class="pre">&lt;PERSON&gt;</span> <span class="pre">&lt;EMAIL&gt;</span> <span class="pre">or</span> <span class="pre">&lt;PHONE&gt;,</span> <span class="pre">he</span> <span class="pre">can</span> <span class="pre">pay</span> <span class="pre">you</span> <span class="pre">with</span> <span class="pre">&lt;CREDIT_CARD&gt;</span></code></p>
<p>The html_str is</p>
<html><body><p><span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John Doe's<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span> <span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">ssn<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span> is <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ffa42133;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">182838483<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">SSN</span></span>, connect me with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">john_doe@gmail.com<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">john_doe@gmail.com<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">EMAIL</span></span> or <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">6288389029<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PHONE</span></span>, he can pay you with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ffa42133;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">41482929939393<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">CREDIT_CARD</span></span>
</span></p></body></html>
<p>The json report that explain the output is</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span>
<span class="w">  </span><span class="p p-Indicator">{</span>
<span class="w">    </span><span class="s">"entity_type"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"PERSON"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># result of the labeling</span>
<span class="w">    </span><span class="s">"start"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># start positon of the entity</span>
<span class="w">    </span><span class="s">"end"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">9</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="c1"># end postion of the entity</span>
<span class="w">    </span><span class="s">"score"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0.99</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># the confident score of the model + context_improvement</span>
<span class="w">    </span><span class="s">"analysis_explanation"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">"recognizer"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"FlairRecognizer"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># which recognizer is used to recognize this entity</span>
<span class="w">      </span><span class="s">"pattern_name"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">"pattern"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">"original_score"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0.99</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># The original confident score from the pre-trained model</span>
<span class="w">      </span><span class="s">"score"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0.99</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># the final score = original_score + score_context_improvement</span>
<span class="w">      </span><span class="s">"textual_explanation"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"Identified</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">PER</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">Flair's</span><span class="nv"> </span><span class="s">Named</span><span class="nv"> </span><span class="s">Entity</span><span class="nv"> </span><span class="s">Recognition"</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">"score_context_improvement"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="c1"># The improvement from the context</span>
<span class="w">      </span><span class="s">"supportive_context_word"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">""</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">"validation_result"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">null</span>
<span class="w">    </span><span class="p p-Indicator">},</span>
<span class="w">    </span><span class="s">"recognition_metadata"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">"recognizer_identifier"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"Flair</span><span class="nv"> </span><span class="s">Analytics_5577088640"</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">"recognizer_name"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"Flair</span><span class="nv"> </span><span class="s">Analytics"</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">},</span>
<span class="w">  </span><span class="nv">....</span>
<span class="p p-Indicator">]</span>
</pre></div>
</div>
<p><a id="chapter3"></a></p>
</section>
<section id="end-to-end-demo">
<h2>3. End-to-end Demo<a class="headerlink" href="#end-to-end-demo" title="Permalink to this headline">#</a></h2>
<section id="recognition-configurations">
<h3>3.1. Recognition configurations<a class="headerlink" href="#recognition-configurations" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>model: which model you want to use.</p></li>
<li><p>entities: What entities to recognize?</p></li>
<li><p>score_threshold: From which score to mark the recogniztion as trusted?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlrun</span>
<span class="n">artifact_path</span> <span class="o">=</span> <span class="s2">"./"</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_or_create_project</span><span class="p">(</span><span class="s2">"pii"</span><span class="p">,</span> <span class="s2">"./"</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">code_to_function</span><span class="p">(</span>
    <span class="n">project</span><span class="o">=</span><span class="s2">"pii"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"pii_recognizer"</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">"pii_recognizer.py"</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">"job"</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">"mlrun/mlrun"</span><span class="p">,</span>
    <span class="n">handler</span><span class="o">=</span><span class="s2">"recognize_pii"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"This function is used to recognize PII in a given text"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">run_obj</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">artifact_path</span> <span class="o">=</span> <span class="n">artifact_path</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span> <span class="p">{</span>
        <span class="s1">'model'</span><span class="p">:</span> <span class="s2">"whole"</span><span class="p">,</span> 
        <span class="s1">'input_path'</span><span class="p">:</span> <span class="s2">"./data/"</span><span class="p">,</span>
        <span class="s1">'output_path'</span><span class="p">:</span> <span class="s2">"./data/output1/"</span><span class="p">,</span>
        <span class="s2">"entities"</span><span class="p">:</span> <span class="p">[</span><span class="s1">'PERSON'</span><span class="p">,</span> <span class="s2">"EMAIL"</span><span class="p">,</span> <span class="s2">"PHONE"</span><span class="p">,</span> <span class="s2">"LOCATION"</span><span class="p">,</span> <span class="s2">"ORGANIZATION"</span><span class="p">],</span> <span class="c1"># the entities that needs to recognize</span>
        <span class="s2">"output_suffix"</span><span class="p">:</span> <span class="s2">"output"</span><span class="p">,</span>
        <span class="s2">"html_key"</span><span class="p">:</span> <span class="s2">"highlighted"</span><span class="p">,</span>
        <span class="s2">"score_threshold"</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="c1"># the score threshold to mark the recognition as trusted</span>
    <span class="p">},</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"output_path: path"</span><span class="p">,</span> <span class="s2">"rpt_json: file"</span><span class="p">,</span> <span class="s2">"errors: file"</span><span class="p">],</span>
    <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 2023-07-31 02:17:04,305 [info] Project loaded successfully: {'project_name': 'pii'}
&gt; 2023-07-31 02:17:04,312 [warning] Failed to add git metadata, ignore if path is not part of a git repo.: {'path': './', 'error': '/User/pii_recognizer'}
&gt; 2023-07-31 02:17:04,408 [warning] artifact/output path is not defined or is local and relative, artifacts will not be visible in the UI: {'output_path': './'}
&gt; 2023-07-31 02:17:04,409 [info] Storing function: {'name': 'pii-recognizer-recognize-pii', 'uid': '51b5ad8144004e52a1008c08850842c8', 'db': None}
2023-07-31 02:17:04,567 loading file /User/.flair/models/flair-pii-distilbert/models--beki--flair-pii-distilbert/snapshots/20fb59f1762edcf253bce67716a94a43cb075ae6/pytorch_model.bin
2023-07-31 02:17:07,730 SequenceTagger predicts: Dictionary with 21 tags: O, S-LOC, B-LOC, E-LOC, I-LOC, S-PER, B-PER, E-PER, I-PER, S-DATE_TIME, B-DATE_TIME, E-DATE_TIME, I-DATE_TIME, S-ORG, B-ORG, E-ORG, I-ORG, S-NRP, B-NRP, E-NRP, I-NRP
Model loaded
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fd09fd6ee2844e13b5839e1fd20ef222", "version_major": 2, "version_minor": 0}</script><div class="output text_html"><style>
.dictlist {
  background-color: #4EC64B;
  text-align: center;
  margin: 4px;
  border-radius: 3px; padding: 0px 3px 1px 3px; display: inline-block;}
.artifact {
  cursor: pointer;
  background-color: #4EC64B;
  text-align: left;
  margin: 4px; border-radius: 3px; padding: 0px 3px 1px 3px; display: inline-block;
}
div.block.hidden {
  display: none;
}
.clickable {
  cursor: pointer;
}
.ellipsis {
  display: inline-block;
  max-width: 60px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.master-wrapper {
  display: flex;
  flex-flow: row nowrap;
  justify-content: flex-start;
  align-items: stretch;
}
.master-tbl {
  flex: 3
}
.master-wrapper > div {
  margin: 4px;
  padding: 10px;
}
iframe.fileview {
  border: 0 none;
  height: 100%;
  width: 100%;
  white-space: pre-wrap;
}
.pane-header-title {
  width: 80%;
  font-weight: 500;
}
.pane-header {
  line-height: 1;
  background-color: #4EC64B;
  padding: 3px;
}
.pane-header .close {
  font-size: 20px;
  font-weight: 700;
  float: right;
  margin-top: -5px;
}
.master-wrapper .right-pane {
  border: 1px inset silver;
  width: 40%;
  min-height: 300px;
  flex: 3
  min-width: 500px;
}
.master-wrapper * {
  box-sizing: border-box;
}
</style><script>
function copyToClipboard(fld) {
    if (document.queryCommandSupported && document.queryCommandSupported('copy')) {
        var textarea = document.createElement('textarea');
        textarea.textContent = fld.innerHTML;
        textarea.style.position = 'fixed';
        document.body.appendChild(textarea);
        textarea.select();

        try {
            return document.execCommand('copy'); // Security exception may be thrown by some browsers.
        } catch (ex) {

        } finally {
            document.body.removeChild(textarea);
        }
    }
}
function expandPanel(el) {
  const panelName = "#" + el.getAttribute('paneName');
  console.log(el.title);

  document.querySelector(panelName + "-title").innerHTML = el.title
  iframe = document.querySelector(panelName + "-body");

  const tblcss = `<style> body { font-family: Arial, Helvetica, sans-serif;}
    #csv { margin-bottom: 15px; }
    #csv table { border-collapse: collapse;}
    #csv table td { padding: 4px 8px; border: 1px solid silver;} </style>`;

  function csvToHtmlTable(str) {
    return '<div id="csv"><table><tr><td>' +  str.replace(/[\n\r]+$/g, '').replace(/[\n\r]+/g, '</td></tr><tr><td>')
      .replace(/,/g, '</td><td>') + '</td></tr></table></div>';
  }

  function reqListener () {
    if (el.title.endsWith(".csv")) {
      iframe.setAttribute("srcdoc", tblcss + csvToHtmlTable(this.responseText));
    } else {
      iframe.setAttribute("srcdoc", this.responseText);
    }
    console.log(this.responseText);
  }

  const oReq = new XMLHttpRequest();
  oReq.addEventListener("load", reqListener);
  oReq.open("GET", el.title);
  oReq.send();


  //iframe.src = el.title;
  const resultPane = document.querySelector(panelName + "-pane");
  if (resultPane.classList.contains("hidden")) {
    resultPane.classList.remove("hidden");
  }
}
function closePanel(el) {
  const panelName = "#" + el.getAttribute('paneName')
  const resultPane = document.querySelector(panelName + "-pane");
  if (!resultPane.classList.contains("hidden")) {
    resultPane.classList.add("hidden");
  }
}

</script>
<div class="master-wrapper">
<div class="block master-tbl"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>project</th>
<th>uid</th>
<th>iter</th>
<th>start</th>
<th>state</th>
<th>name</th>
<th>labels</th>
<th>inputs</th>
<th>parameters</th>
<th>results</th>
<th>artifacts</th>
</tr>
</thead>
<tbody>
<tr>
<td>pii</td>
<td><div title="51b5ad8144004e52a1008c08850842c8"><a href="https://dashboard.default-tenant.app.llm2.iguazio-cd0.com/mlprojects/pii/jobs/monitor/51b5ad8144004e52a1008c08850842c8/overview" target="_blank">...850842c8</a></div></td>
<td>0</td>
<td>Jul 31 02:17:04</td>
<td>completed</td>
<td>pii-recognizer-recognize-pii</td>
<td><div class="dictlist">v3io_user=pengw</div><div class="dictlist">kind=</div><div class="dictlist">owner=pengw</div><div class="dictlist">host=jupyter-pengw-5f99fb678d-mnvxl</div></td>
<td></td>
<td><div class="dictlist">model=whole</div><div class="dictlist">input_path=./data/</div><div class="dictlist">output_path=./data/output1/</div><div class="dictlist">entities=['PERSON', 'EMAIL', 'PHONE', 'LOCATION', 'ORGANIZATION']</div><div class="dictlist">output_suffix=output</div><div class="dictlist">html_key=highlighted</div><div class="dictlist">score_threshold=0.5</div></td>
<td></td>
<td><div class="artifact" onclick="expandPanel(this)" panename="result3723389a" title="/files/pii_recognizer/pii-recognizer-recognize-pii/0/highlighted.html">highlighted</div><div title="/User/pii_recognizer/pii-recognizer-recognize-pii/0/output_path.zip">output_path</div><div class="artifact" onclick="expandPanel(this)" panename="result3723389a" title="/files/pii_recognizer/pii-recognizer-recognize-pii/0/rpt_json.json">rpt_json</div><div title="/User/pii_recognizer/pii-recognizer-recognize-pii/0/errors.npz">errors</div></td>
</tr>
</tbody>
</table>
</div></div>
<div class="right-pane block hidden" id="result3723389a-pane">
<div class="pane-header">
<span class="pane-header-title" id="result3723389a-title">Title</span>
<span class="close clickable" onclick="closePanel(this)" panename="result3723389a">×</span>
</div>
<iframe class="fileview" id="result3723389a-body"></iframe>
</div>
</div>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_html"><b> &gt; to track results use the .show() or .logs() methods  or <a href="https://dashboard.default-tenant.app.llm2.iguazio-cd0.com/mlprojects/pii/jobs/monitor/51b5ad8144004e52a1008c08850842c8/overview" target="_blank">click here</a> to open in UI</b></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 2023-07-31 02:17:12,403 [info] Run execution finished: {'status': 'completed', 'name': 'pii-recognizer-recognize-pii'}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the mlrun context</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_or_create_ctx</span><span class="p">(</span><span class="s1">'pii_ctx1'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="n">tqdm</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">"./data/output1/"</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.txt"</span><span class="p">)),</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">"Processing files"</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">"file"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">):</span>
            <span class="c1"># Load the str from the text file</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">txt_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c23dc77030224dfc825d7da86c6c1220", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dear Mr. &lt;PERSON&gt;,

We are pleased to inform you that you have been selected as the winner of our exclusive vacation package giveaway! Congratulations! You, along with your family, will enjoy a luxurious stay at our resort in the beautiful city of &lt;ORGANIZATION&gt;. Your flight tickets have been booked, and you will be departing on July 15th, 2023.

Please provide us with the necessary details to finalize your travel arrangements. We kindly request your full name, date of birth, passport number, and contact information. Rest assured that all provided information will be handled with utmost confidentiality and in compliance with data protection regulations.

We look forward to creating unforgettable memories for you and your loved ones during your stay with us. If you have any questions or require further assistance, please don't hesitate to contact our customer support team.

&lt;PERSON&gt; &lt;ORGANIZATION&gt; is 182838483, connect him with &lt;EMAIL&gt; or &lt;PHONE&gt;, he can pay you with &lt;PHONE&gt;9393
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check the highlighted html </span>
<span class="n">html_output</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_cached_artifact</span><span class="p">(</span><span class="s2">"highlighted"</span><span class="p">)</span>
<span class="n">html_str</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_dataitem</span><span class="p">(</span><span class="n">html_output</span><span class="o">.</span><span class="n">get_target_path</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_str</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><html><head><title>Highlighted Pii Entities</title></head><body><h1>Highlighted Pii Entities</h1><ul><li><a href="#data/letter.txt">data/letter.txt</a></li><li><a href="#data/pii_data.txt">data/pii_data.txt</a></li></ul><li><h2>data/letter.txt</h2><p><p><span>Dear Mr. <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John Doe<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span>,

We are pleased to inform you that you have been selected as the winner of our exclusive vacation package giveaway! Congratulations! You, along with your family, will enjoy a luxurious stay at our resort in the beautiful city of <span style="display:inline-flex;flex-direction:row;align-items:center;background:#803df566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">Riviera<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">LOCATION</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">Riviera<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span>. Your flight tickets have been booked, and you will be departing on July 15th, 2023.

Please provide us with the necessary details to finalize your travel arrangements. We kindly request your full name, date of birth, passport number, and contact information. Rest assured that all provided information will be handled with utmost confidentiality and in compliance with data protection regulations.

We look forward to creating unforgettable memories for you and your loved ones during your stay with us. If you have any questions or require further assistance, please don't hesitate to contact our customer support team.
</span></p></p></li><li><h2>data/pii_data.txt</h2><p><p><span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John smith's<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span> <span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">ssn<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span> is 182838483, connect him with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John_smith@gmail.com<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">EMAIL</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">smith<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span>@gmail.com or <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">6288389029<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PHONE</span></span>, he can pay you with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">4148292993<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PHONE</span></span>9393</span></p></p></li></body></html></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check the json report about the explanation.</span>
<span class="n">rpt_output1</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_cached_artifact</span><span class="p">(</span><span class="s2">"rpt_json"</span><span class="p">)</span>
<span class="n">rpt_str1</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_dataitem</span><span class="p">(</span><span class="n">rpt_output1</span><span class="o">.</span><span class="n">get_target_path</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rpt_str1</span><span class="p">)</span>
 
<span class="c1"># Pretty Print JSON</span>
<span class="n">json_formatted_str1</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json_formatted_str1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    "data/letter.txt": [
        {
            "entity_type": "PERSON",
            "start": 9,
            "end": 17,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as PERSON by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139944219101744"
            }
        },
        {
            "entity_type": "LOCATION",
            "start": 248,
            "end": 255,
            "score": 1.0,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1.0,
                "score": 1.0,
                "textual_explanation": "Identified as LOC by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944219101936",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "ORGANIZATION",
            "start": 248,
            "end": 255,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as ORG by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139944219101744"
            }
        }
    ],
    "data/pii_data.txt": [
        {
            "entity_type": "PERSON",
            "start": 0,
            "end": 12,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as PERSON by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139944219101744"
            }
        },
        {
            "entity_type": "ORGANIZATION",
            "start": 13,
            "end": 16,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as ORG by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139944219101744"
            }
        },
        {
            "entity_type": "PERSON",
            "start": 53,
            "end": 58,
            "score": 1.0,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1.0,
                "score": 1.0,
                "textual_explanation": "Identified as PER by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944219101936",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "PERSON",
            "start": 48,
            "end": 52,
            "score": 0.87,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 0.87,
                "score": 0.87,
                "textual_explanation": "Identified as PER by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944219101936",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "EMAIL",
            "start": 48,
            "end": 68,
            "score": 0.5,
            "analysis_explanation": {
                "recognizer": "PatternRecognizer",
                "pattern_name": "EMAIL",
                "pattern": "\\S+@\\S+",
                "original_score": 0.5,
                "score": 0.5,
                "textual_explanation": null,
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "PatternRecognizer",
                "recognizer_identifier": "PatternRecognizer_139944352474640"
            }
        },
        {
            "entity_type": "PHONE",
            "start": 72,
            "end": 82,
            "score": 0.5,
            "analysis_explanation": {
                "recognizer": "PatternRecognizer",
                "pattern_name": "PHONE",
                "pattern": "\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}",
                "original_score": 0.5,
                "score": 0.5,
                "textual_explanation": null,
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "PatternRecognizer",
                "recognizer_identifier": "PatternRecognizer_139944352476560"
            }
        },
        {
            "entity_type": "PHONE",
            "start": 104,
            "end": 114,
            "score": 0.5,
            "analysis_explanation": {
                "recognizer": "PatternRecognizer",
                "pattern_name": "PHONE",
                "pattern": "\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}",
                "original_score": 0.5,
                "score": 0.5,
                "textual_explanation": null,
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "PatternRecognizer",
                "recognizer_identifier": "PatternRecognizer_139944352476560"
            }
        }
    ]
}
</pre></div>
</div>
</div>
</div>
</section>
<section id="masking-configurations">
<h3>3.2. Masking configurations<a class="headerlink" href="#masking-configurations" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>entity_operator_map: it defined what to do with recognized tokens? Mask them? mask them with what? remove them? replace them?</p></li>
</ul>
<pre>
     entity_operator_map = {
        "PERSON": ("keep", {}),
        "EMAIL": ("mask", {"masking_char": "😀", "chars_to_mask": 5, "from_end": False}),
        "PHONE": ("hash", {}),
        "LOCATION": ("redact", {}),
        "ORGANIZATION": ("replace", {"new_value": "Company XYZ"})
        }
     </pre><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlrun</span>
<span class="n">artifact_path</span> <span class="o">=</span> <span class="s2">"./"</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_or_create_project</span><span class="p">(</span><span class="s2">"pii"</span><span class="p">,</span> <span class="s2">"./"</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">code_to_function</span><span class="p">(</span>
    <span class="n">project</span><span class="o">=</span><span class="s2">"pii"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"pii_recognizer"</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">"pii_recognizer.py"</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">"job"</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">"mlrun/mlrun"</span><span class="p">,</span>
    <span class="n">handler</span><span class="o">=</span><span class="s2">"recognize_pii"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"This function is used to recognize PII in a given text"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">entity_operator_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"PERSON"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"keep"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"EMAIL"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"mask"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"masking_char"</span><span class="p">:</span> <span class="s2">"😀"</span><span class="p">,</span> <span class="s2">"chars_to_mask"</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">"from_end"</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
        <span class="s2">"PHONE"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"hash"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"LOCATION"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"redact"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"ORGANIZATION"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"replace"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"new_value"</span><span class="p">:</span> <span class="s2">"Company XYZ"</span><span class="p">})</span>
        <span class="p">}</span>
<span class="n">run_obj</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">artifact_path</span> <span class="o">=</span> <span class="n">artifact_path</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span> <span class="p">{</span>
        <span class="s1">'model'</span><span class="p">:</span> <span class="s2">"whole"</span><span class="p">,</span> 
        <span class="s1">'input_path'</span><span class="p">:</span> <span class="s2">"./data/"</span><span class="p">,</span>
        <span class="s1">'output_path'</span><span class="p">:</span> <span class="s2">"./data/output2/"</span><span class="p">,</span>
        <span class="s2">"entities"</span><span class="p">:</span> <span class="p">[</span><span class="s1">'PERSON'</span><span class="p">,</span> <span class="s2">"EMAIL"</span><span class="p">,</span> <span class="s2">"PHONE"</span><span class="p">,</span> <span class="s2">"LOCATION"</span><span class="p">,</span> <span class="s2">"ORGANIZATION"</span><span class="p">],</span>
        <span class="s2">"output_suffix"</span><span class="p">:</span> <span class="s2">"output"</span><span class="p">,</span>
        <span class="s2">"html_key"</span><span class="p">:</span> <span class="s2">"highlighted"</span><span class="p">,</span>
        <span class="s2">"score_threshold"</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">"entity_operator_map"</span><span class="p">:</span> <span class="n">entity_operator_map</span><span class="p">,</span>
        
    <span class="p">},</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"output_path: path"</span><span class="p">,</span> <span class="s2">"rpt_json: file"</span><span class="p">,</span> <span class="s2">"errors: file"</span><span class="p">],</span>
    <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 2023-07-31 02:20:40,550 [info] Project loaded successfully: {'project_name': 'pii'}
&gt; 2023-07-31 02:20:40,556 [warning] Failed to add git metadata, ignore if path is not part of a git repo.: {'path': './', 'error': '/User/pii_recognizer'}
&gt; 2023-07-31 02:20:40,649 [warning] artifact/output path is not defined or is local and relative, artifacts will not be visible in the UI: {'output_path': './'}
&gt; 2023-07-31 02:20:40,649 [info] Storing function: {'name': 'pii-recognizer-recognize-pii', 'uid': '2b43f80c7ca44b43b229760bb55f814d', 'db': None}
2023-07-31 02:20:40,812 loading file /User/.flair/models/flair-pii-distilbert/models--beki--flair-pii-distilbert/snapshots/20fb59f1762edcf253bce67716a94a43cb075ae6/pytorch_model.bin
2023-07-31 02:20:44,130 SequenceTagger predicts: Dictionary with 21 tags: O, S-LOC, B-LOC, E-LOC, I-LOC, S-PER, B-PER, E-PER, I-PER, S-DATE_TIME, B-DATE_TIME, E-DATE_TIME, I-DATE_TIME, S-ORG, B-ORG, E-ORG, I-ORG, S-NRP, B-NRP, E-NRP, I-NRP
Model loaded
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5ad56413aad64e59b177666ca0a89a01", "version_major": 2, "version_minor": 0}</script><div class="output text_html"><style>
.dictlist {
  background-color: #4EC64B;
  text-align: center;
  margin: 4px;
  border-radius: 3px; padding: 0px 3px 1px 3px; display: inline-block;}
.artifact {
  cursor: pointer;
  background-color: #4EC64B;
  text-align: left;
  margin: 4px; border-radius: 3px; padding: 0px 3px 1px 3px; display: inline-block;
}
div.block.hidden {
  display: none;
}
.clickable {
  cursor: pointer;
}
.ellipsis {
  display: inline-block;
  max-width: 60px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.master-wrapper {
  display: flex;
  flex-flow: row nowrap;
  justify-content: flex-start;
  align-items: stretch;
}
.master-tbl {
  flex: 3
}
.master-wrapper > div {
  margin: 4px;
  padding: 10px;
}
iframe.fileview {
  border: 0 none;
  height: 100%;
  width: 100%;
  white-space: pre-wrap;
}
.pane-header-title {
  width: 80%;
  font-weight: 500;
}
.pane-header {
  line-height: 1;
  background-color: #4EC64B;
  padding: 3px;
}
.pane-header .close {
  font-size: 20px;
  font-weight: 700;
  float: right;
  margin-top: -5px;
}
.master-wrapper .right-pane {
  border: 1px inset silver;
  width: 40%;
  min-height: 300px;
  flex: 3
  min-width: 500px;
}
.master-wrapper * {
  box-sizing: border-box;
}
</style><script>
function copyToClipboard(fld) {
    if (document.queryCommandSupported && document.queryCommandSupported('copy')) {
        var textarea = document.createElement('textarea');
        textarea.textContent = fld.innerHTML;
        textarea.style.position = 'fixed';
        document.body.appendChild(textarea);
        textarea.select();

        try {
            return document.execCommand('copy'); // Security exception may be thrown by some browsers.
        } catch (ex) {

        } finally {
            document.body.removeChild(textarea);
        }
    }
}
function expandPanel(el) {
  const panelName = "#" + el.getAttribute('paneName');
  console.log(el.title);

  document.querySelector(panelName + "-title").innerHTML = el.title
  iframe = document.querySelector(panelName + "-body");

  const tblcss = `<style> body { font-family: Arial, Helvetica, sans-serif;}
    #csv { margin-bottom: 15px; }
    #csv table { border-collapse: collapse;}
    #csv table td { padding: 4px 8px; border: 1px solid silver;} </style>`;

  function csvToHtmlTable(str) {
    return '<div id="csv"><table><tr><td>' +  str.replace(/[\n\r]+$/g, '').replace(/[\n\r]+/g, '</td></tr><tr><td>')
      .replace(/,/g, '</td><td>') + '</td></tr></table></div>';
  }

  function reqListener () {
    if (el.title.endsWith(".csv")) {
      iframe.setAttribute("srcdoc", tblcss + csvToHtmlTable(this.responseText));
    } else {
      iframe.setAttribute("srcdoc", this.responseText);
    }
    console.log(this.responseText);
  }

  const oReq = new XMLHttpRequest();
  oReq.addEventListener("load", reqListener);
  oReq.open("GET", el.title);
  oReq.send();


  //iframe.src = el.title;
  const resultPane = document.querySelector(panelName + "-pane");
  if (resultPane.classList.contains("hidden")) {
    resultPane.classList.remove("hidden");
  }
}
function closePanel(el) {
  const panelName = "#" + el.getAttribute('paneName')
  const resultPane = document.querySelector(panelName + "-pane");
  if (!resultPane.classList.contains("hidden")) {
    resultPane.classList.add("hidden");
  }
}

</script>
<div class="master-wrapper">
<div class="block master-tbl"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>project</th>
<th>uid</th>
<th>iter</th>
<th>start</th>
<th>state</th>
<th>name</th>
<th>labels</th>
<th>inputs</th>
<th>parameters</th>
<th>results</th>
<th>artifacts</th>
</tr>
</thead>
<tbody>
<tr>
<td>pii</td>
<td><div title="2b43f80c7ca44b43b229760bb55f814d"><a href="https://dashboard.default-tenant.app.llm2.iguazio-cd0.com/mlprojects/pii/jobs/monitor/2b43f80c7ca44b43b229760bb55f814d/overview" target="_blank">...b55f814d</a></div></td>
<td>0</td>
<td>Jul 31 02:20:40</td>
<td>completed</td>
<td>pii-recognizer-recognize-pii</td>
<td><div class="dictlist">v3io_user=pengw</div><div class="dictlist">kind=</div><div class="dictlist">owner=pengw</div><div class="dictlist">host=jupyter-pengw-5f99fb678d-mnvxl</div></td>
<td></td>
<td><div class="dictlist">model=whole</div><div class="dictlist">input_path=./data/</div><div class="dictlist">output_path=./data/output2/</div><div class="dictlist">entities=['PERSON', 'EMAIL', 'PHONE', 'LOCATION', 'ORGANIZATION']</div><div class="dictlist">output_suffix=output</div><div class="dictlist">html_key=highlighted</div><div class="dictlist">score_threshold=0.5</div><div class="dictlist">entity_operator_map={'PERSON': ('keep', {}), 'EMAIL': ('mask', {'masking_char': '😀', 'chars_to_mask': 100, 'from_end': False, 'entity_type': 'EMAIL'}), 'PHONE': ('hash', {}), 'LOCATION': ('redact', {}), 'ORGANIZATION': ('replace', {'new_value': 'Company XYZ', 'entity_type': 'ORGANIZATION'})}</div></td>
<td></td>
<td><div class="artifact" onclick="expandPanel(this)" panename="result0751a876" title="/files/pii_recognizer/pii-recognizer-recognize-pii/0/highlighted.html">highlighted</div><div title="/User/pii_recognizer/pii-recognizer-recognize-pii/0/output_path.zip">output_path</div><div class="artifact" onclick="expandPanel(this)" panename="result0751a876" title="/files/pii_recognizer/pii-recognizer-recognize-pii/0/rpt_json.json">rpt_json</div><div title="/User/pii_recognizer/pii-recognizer-recognize-pii/0/errors.npz">errors</div></td>
</tr>
</tbody>
</table>
</div></div>
<div class="right-pane block hidden" id="result0751a876-pane">
<div class="pane-header">
<span class="pane-header-title" id="result0751a876-title">Title</span>
<span class="close clickable" onclick="closePanel(this)" panename="result0751a876">×</span>
</div>
<iframe class="fileview" id="result0751a876-body"></iframe>
</div>
</div>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_html"><b> &gt; to track results use the .show() or .logs() methods  or <a href="https://dashboard.default-tenant.app.llm2.iguazio-cd0.com/mlprojects/pii/jobs/monitor/2b43f80c7ca44b43b229760bb55f814d/overview" target="_blank">click here</a> to open in UI</b></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 2023-07-31 02:20:48,903 [info] Run execution finished: {'status': 'completed', 'name': 'pii-recognizer-recognize-pii'}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the mlrun context</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_or_create_ctx</span><span class="p">(</span><span class="s1">'pii_ctx1'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="n">tqdm</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">"./data/output2/"</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.txt"</span><span class="p">)),</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">"Processing files"</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">"file"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">):</span>
            <span class="c1"># Load the str from the text file</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">txt_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "552ad96fd23e497ea6e547936c7853a0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dear Mr. John Doe,

We are pleased to inform you that you have been selected as the winner of our exclusive vacation package giveaway! Congratulations! You, along with your family, will enjoy a luxurious stay at our resort in the beautiful city of Company XYZ. Your flight tickets have been booked, and you will be departing on July 15th, 2023.

Please provide us with the necessary details to finalize your travel arrangements. We kindly request your full name, date of birth, passport number, and contact information. Rest assured that all provided information will be handled with utmost confidentiality and in compliance with data protection regulations.

We look forward to creating unforgettable memories for you and your loved ones during your stay with us. If you have any questions or require further assistance, please don't hesitate to contact our customer support team.

John smith's Company XYZ is 182838483, connect him with 😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀 or 3990096a212e92850c3b3c8e57ab398252d482444a32def6b030cbac2d51efa3, he can pay you with a6983d9477e93eab115305afd124bd096699e6cb7d2ce72ec6e29a6378a4e8059393
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check the highlighted html </span>
<span class="n">html_output</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_cached_artifact</span><span class="p">(</span><span class="s2">"highlighted"</span><span class="p">)</span>
<span class="n">html_str</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_dataitem</span><span class="p">(</span><span class="n">html_output</span><span class="o">.</span><span class="n">get_target_path</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_str</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><html><head><title>Highlighted Pii Entities</title></head><body><h1>Highlighted Pii Entities</h1><ul><li><a href="#data/letter.txt">data/letter.txt</a></li><li><a href="#data/pii_data.txt">data/pii_data.txt</a></li></ul><li><h2>data/letter.txt</h2><p><p><span>Dear Mr. <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John Doe<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span>,

We are pleased to inform you that you have been selected as the winner of our exclusive vacation package giveaway! Congratulations! You, along with your family, will enjoy a luxurious stay at our resort in the beautiful city of <span style="display:inline-flex;flex-direction:row;align-items:center;background:#803df566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">Riviera<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">LOCATION</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">Riviera<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span>. Your flight tickets have been booked, and you will be departing on July 15th, 2023.

Please provide us with the necessary details to finalize your travel arrangements. We kindly request your full name, date of birth, passport number, and contact information. Rest assured that all provided information will be handled with utmost confidentiality and in compliance with data protection regulations.

We look forward to creating unforgettable memories for you and your loved ones during your stay with us. If you have any questions or require further assistance, please don't hesitate to contact our customer support team.
</span></p></p></li><li><h2>data/pii_data.txt</h2><p><p><span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John smith's<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span> <span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">ssn<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span> is 182838483, connect him with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John_smith@gmail.com<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">EMAIL</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">smith<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span>@gmail.com or <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">6288389029<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PHONE</span></span>, he can pay you with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">4148292993<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PHONE</span></span>9393</span></p></p></li></body></html></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check the json report about the explanation.</span>
<span class="n">rpt_output1</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_cached_artifact</span><span class="p">(</span><span class="s2">"rpt_json"</span><span class="p">)</span>
<span class="n">rpt_str1</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_dataitem</span><span class="p">(</span><span class="n">rpt_output1</span><span class="o">.</span><span class="n">get_target_path</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rpt_str1</span><span class="p">)</span>
 
<span class="c1"># Pretty Print JSON</span>
<span class="n">json_formatted_str1</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json_formatted_str1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    "data/letter.txt": [
        {
            "entity_type": "PERSON",
            "start": 9,
            "end": 17,
            "score": 1.0,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1.0,
                "score": 1.0,
                "textual_explanation": "Identified as PER by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944345555488",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "LOCATION",
            "start": 248,
            "end": 255,
            "score": 1.0,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1.0,
                "score": 1.0,
                "textual_explanation": "Identified as LOC by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944345555488",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "ORGANIZATION",
            "start": 248,
            "end": 255,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as ORG by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139943499301312"
            }
        }
    ],
    "data/pii_data.txt": [
        {
            "entity_type": "PERSON",
            "start": 0,
            "end": 12,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as PERSON by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139943499301312"
            }
        },
        {
            "entity_type": "ORGANIZATION",
            "start": 13,
            "end": 16,
            "score": 1,
            "analysis_explanation": {
                "recognizer": "CustomSpacyRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1,
                "score": 1,
                "textual_explanation": "Identified as ORG by Spacy's Named Entity Recognition (Privy-trained)",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "CustomSpacyRecognizer",
                "recognizer_identifier": "CustomSpacyRecognizer_139943499301312"
            }
        },
        {
            "entity_type": "PERSON",
            "start": 53,
            "end": 58,
            "score": 1.0,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 1.0,
                "score": 1.0,
                "textual_explanation": "Identified as PER by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944345555488",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "PERSON",
            "start": 48,
            "end": 52,
            "score": 0.87,
            "analysis_explanation": {
                "recognizer": "FlairRecognizer",
                "pattern_name": null,
                "pattern": null,
                "original_score": 0.87,
                "score": 0.87,
                "textual_explanation": "Identified as PER by Flair's Named Entity Recognition",
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_identifier": "Flair Analytics_139944345555488",
                "recognizer_name": "Flair Analytics"
            }
        },
        {
            "entity_type": "EMAIL",
            "start": 48,
            "end": 68,
            "score": 0.5,
            "analysis_explanation": {
                "recognizer": "PatternRecognizer",
                "pattern_name": "EMAIL",
                "pattern": "\\S+@\\S+",
                "original_score": 0.5,
                "score": 0.5,
                "textual_explanation": null,
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "PatternRecognizer",
                "recognizer_identifier": "PatternRecognizer_139943864893792"
            }
        },
        {
            "entity_type": "PHONE",
            "start": 72,
            "end": 82,
            "score": 0.5,
            "analysis_explanation": {
                "recognizer": "PatternRecognizer",
                "pattern_name": "PHONE",
                "pattern": "\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}",
                "original_score": 0.5,
                "score": 0.5,
                "textual_explanation": null,
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "PatternRecognizer",
                "recognizer_identifier": "PatternRecognizer_139943864894128"
            }
        },
        {
            "entity_type": "PHONE",
            "start": 104,
            "end": 114,
            "score": 0.5,
            "analysis_explanation": {
                "recognizer": "PatternRecognizer",
                "pattern_name": "PHONE",
                "pattern": "\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}",
                "original_score": 0.5,
                "score": 0.5,
                "textual_explanation": null,
                "score_context_improvement": 0,
                "supportive_context_word": "",
                "validation_result": null
            },
            "recognition_metadata": {
                "recognizer_name": "PatternRecognizer",
                "recognizer_identifier": "PatternRecognizer_139943864894128"
            }
        }
    ]
}
</pre></div>
</div>
</div>
</div>
</section>
<section id="output-configurations">
<h3>3.3 Output configurations<a class="headerlink" href="#output-configurations" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>is_full_text: whether produce full text or just the sentences have PII entities in it</p></li>
<li><p>generate_html: whether to produce the html with highlighted pii entities</p></li>
<li><p>generate_json: whether to proudce the json report with the explaination of the process</p></li>
<li><p>is_full_html: whether produce full text with the pii entities highlighted or just sentences with pii entities.</p></li>
<li><p>is_full_report: whether produce the json report with detailed information or just start, end index and scores.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlrun</span>
<span class="n">artifact_path</span> <span class="o">=</span> <span class="s2">"./"</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_or_create_project</span><span class="p">(</span><span class="s2">"pii"</span><span class="p">,</span> <span class="s2">"./"</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">code_to_function</span><span class="p">(</span>
    <span class="n">project</span><span class="o">=</span><span class="s2">"pii"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"pii_recognizer"</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">"pii_recognizer.py"</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">"job"</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">"mlrun/mlrun"</span><span class="p">,</span>
    <span class="n">handler</span><span class="o">=</span><span class="s2">"recognize_pii"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"This function is used to recognize PII in a given text"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">entity_operator_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"PERSON"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"keep"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"EMAIL"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"mask"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"masking_char"</span><span class="p">:</span> <span class="s2">"😀"</span><span class="p">,</span> <span class="s2">"chars_to_mask"</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">"from_end"</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
        <span class="s2">"PHONE"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"hash"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"LOCATION"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"redact"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"ORGANIZATION"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"replace"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"new_value"</span><span class="p">:</span> <span class="s2">"Company XYZ"</span><span class="p">})</span>
        <span class="p">}</span>
<span class="n">run_obj</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">artifact_path</span> <span class="o">=</span> <span class="n">artifact_path</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span> <span class="p">{</span>
        <span class="s1">'model'</span><span class="p">:</span> <span class="s2">"whole"</span><span class="p">,</span> 
        <span class="s1">'input_path'</span><span class="p">:</span> <span class="s2">"./data/"</span><span class="p">,</span>
        <span class="s1">'output_path'</span><span class="p">:</span> <span class="s2">"./data/output3/"</span><span class="p">,</span>
        <span class="s2">"entities"</span><span class="p">:</span> <span class="p">[</span><span class="s1">'PERSON'</span><span class="p">,</span> <span class="s2">"EMAIL"</span><span class="p">,</span> <span class="s2">"PHONE"</span><span class="p">,</span> <span class="s2">"LOCATION"</span><span class="p">,</span> <span class="s2">"ORGANIZATION"</span><span class="p">],</span>
        <span class="s2">"output_suffix"</span><span class="p">:</span> <span class="s2">"output"</span><span class="p">,</span>
        <span class="s2">"html_key"</span><span class="p">:</span> <span class="s2">"highlighted"</span><span class="p">,</span>
        <span class="s2">"score_threshold"</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">"entity_operator_map"</span><span class="p">:</span> <span class="n">entity_operator_map</span><span class="p">,</span>
        <span class="s2">"is_full_text"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">"is_full_html"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">"is_full_report"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"output_path: path"</span><span class="p">,</span> <span class="s2">"rpt_json: file"</span><span class="p">,</span> <span class="s2">"errors: file"</span><span class="p">],</span>
    <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 2023-07-31 02:22:57,789 [info] Project loaded successfully: {'project_name': 'pii'}
&gt; 2023-07-31 02:22:57,799 [warning] Failed to add git metadata, ignore if path is not part of a git repo.: {'path': './', 'error': '/User/pii_recognizer'}
&gt; 2023-07-31 02:22:57,891 [warning] artifact/output path is not defined or is local and relative, artifacts will not be visible in the UI: {'output_path': './'}
&gt; 2023-07-31 02:22:57,892 [info] Storing function: {'name': 'pii-recognizer-recognize-pii', 'uid': '3f6d701e423346b39026dc365698c15c', 'db': None}
2023-07-31 02:22:58,079 loading file /User/.flair/models/flair-pii-distilbert/models--beki--flair-pii-distilbert/snapshots/20fb59f1762edcf253bce67716a94a43cb075ae6/pytorch_model.bin
2023-07-31 02:23:01,565 SequenceTagger predicts: Dictionary with 21 tags: O, S-LOC, B-LOC, E-LOC, I-LOC, S-PER, B-PER, E-PER, I-PER, S-DATE_TIME, B-DATE_TIME, E-DATE_TIME, I-DATE_TIME, S-ORG, B-ORG, E-ORG, I-ORG, S-NRP, B-NRP, E-NRP, I-NRP
Model loaded
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ad05f59e8c604629a01f797dc84ec530", "version_major": 2, "version_minor": 0}</script><div class="output text_html"><style>
.dictlist {
  background-color: #4EC64B;
  text-align: center;
  margin: 4px;
  border-radius: 3px; padding: 0px 3px 1px 3px; display: inline-block;}
.artifact {
  cursor: pointer;
  background-color: #4EC64B;
  text-align: left;
  margin: 4px; border-radius: 3px; padding: 0px 3px 1px 3px; display: inline-block;
}
div.block.hidden {
  display: none;
}
.clickable {
  cursor: pointer;
}
.ellipsis {
  display: inline-block;
  max-width: 60px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.master-wrapper {
  display: flex;
  flex-flow: row nowrap;
  justify-content: flex-start;
  align-items: stretch;
}
.master-tbl {
  flex: 3
}
.master-wrapper > div {
  margin: 4px;
  padding: 10px;
}
iframe.fileview {
  border: 0 none;
  height: 100%;
  width: 100%;
  white-space: pre-wrap;
}
.pane-header-title {
  width: 80%;
  font-weight: 500;
}
.pane-header {
  line-height: 1;
  background-color: #4EC64B;
  padding: 3px;
}
.pane-header .close {
  font-size: 20px;
  font-weight: 700;
  float: right;
  margin-top: -5px;
}
.master-wrapper .right-pane {
  border: 1px inset silver;
  width: 40%;
  min-height: 300px;
  flex: 3
  min-width: 500px;
}
.master-wrapper * {
  box-sizing: border-box;
}
</style><script>
function copyToClipboard(fld) {
    if (document.queryCommandSupported && document.queryCommandSupported('copy')) {
        var textarea = document.createElement('textarea');
        textarea.textContent = fld.innerHTML;
        textarea.style.position = 'fixed';
        document.body.appendChild(textarea);
        textarea.select();

        try {
            return document.execCommand('copy'); // Security exception may be thrown by some browsers.
        } catch (ex) {

        } finally {
            document.body.removeChild(textarea);
        }
    }
}
function expandPanel(el) {
  const panelName = "#" + el.getAttribute('paneName');
  console.log(el.title);

  document.querySelector(panelName + "-title").innerHTML = el.title
  iframe = document.querySelector(panelName + "-body");

  const tblcss = `<style> body { font-family: Arial, Helvetica, sans-serif;}
    #csv { margin-bottom: 15px; }
    #csv table { border-collapse: collapse;}
    #csv table td { padding: 4px 8px; border: 1px solid silver;} </style>`;

  function csvToHtmlTable(str) {
    return '<div id="csv"><table><tr><td>' +  str.replace(/[\n\r]+$/g, '').replace(/[\n\r]+/g, '</td></tr><tr><td>')
      .replace(/,/g, '</td><td>') + '</td></tr></table></div>';
  }

  function reqListener () {
    if (el.title.endsWith(".csv")) {
      iframe.setAttribute("srcdoc", tblcss + csvToHtmlTable(this.responseText));
    } else {
      iframe.setAttribute("srcdoc", this.responseText);
    }
    console.log(this.responseText);
  }

  const oReq = new XMLHttpRequest();
  oReq.addEventListener("load", reqListener);
  oReq.open("GET", el.title);
  oReq.send();


  //iframe.src = el.title;
  const resultPane = document.querySelector(panelName + "-pane");
  if (resultPane.classList.contains("hidden")) {
    resultPane.classList.remove("hidden");
  }
}
function closePanel(el) {
  const panelName = "#" + el.getAttribute('paneName')
  const resultPane = document.querySelector(panelName + "-pane");
  if (!resultPane.classList.contains("hidden")) {
    resultPane.classList.add("hidden");
  }
}

</script>
<div class="master-wrapper">
<div class="block master-tbl"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>project</th>
<th>uid</th>
<th>iter</th>
<th>start</th>
<th>state</th>
<th>name</th>
<th>labels</th>
<th>inputs</th>
<th>parameters</th>
<th>results</th>
<th>artifacts</th>
</tr>
</thead>
<tbody>
<tr>
<td>pii</td>
<td><div title="3f6d701e423346b39026dc365698c15c"><a href="https://dashboard.default-tenant.app.llm2.iguazio-cd0.com/mlprojects/pii/jobs/monitor/3f6d701e423346b39026dc365698c15c/overview" target="_blank">...5698c15c</a></div></td>
<td>0</td>
<td>Jul 31 02:22:57</td>
<td>completed</td>
<td>pii-recognizer-recognize-pii</td>
<td><div class="dictlist">v3io_user=pengw</div><div class="dictlist">kind=</div><div class="dictlist">owner=pengw</div><div class="dictlist">host=jupyter-pengw-5f99fb678d-mnvxl</div></td>
<td></td>
<td><div class="dictlist">model=whole</div><div class="dictlist">input_path=./data/</div><div class="dictlist">output_path=./data/output3/</div><div class="dictlist">entities=['PERSON', 'EMAIL', 'PHONE', 'LOCATION', 'ORGANIZATION']</div><div class="dictlist">output_suffix=output</div><div class="dictlist">html_key=highlighted</div><div class="dictlist">score_threshold=0.5</div><div class="dictlist">entity_operator_map={'PERSON': ('keep', {}), 'EMAIL': ('mask', {'masking_char': '😀', 'chars_to_mask': 100, 'from_end': False, 'entity_type': 'EMAIL'}), 'PHONE': ('hash', {}), 'LOCATION': ('redact', {}), 'ORGANIZATION': ('replace', {'new_value': 'Company XYZ', 'entity_type': 'ORGANIZATION'})}</div><div class="dictlist">is_full_text=False</div><div class="dictlist">is_full_html=False</div><div class="dictlist">is_full_report=False</div></td>
<td></td>
<td><div class="artifact" onclick="expandPanel(this)" panename="result1d30d4ed" title="/files/pii_recognizer/pii-recognizer-recognize-pii/0/highlighted.html">highlighted</div><div title="/User/pii_recognizer/pii-recognizer-recognize-pii/0/output_path.zip">output_path</div><div class="artifact" onclick="expandPanel(this)" panename="result1d30d4ed" title="/files/pii_recognizer/pii-recognizer-recognize-pii/0/rpt_json.json">rpt_json</div><div title="/User/pii_recognizer/pii-recognizer-recognize-pii/0/errors.npz">errors</div></td>
</tr>
</tbody>
</table>
</div></div>
<div class="right-pane block hidden" id="result1d30d4ed-pane">
<div class="pane-header">
<span class="pane-header-title" id="result1d30d4ed-title">Title</span>
<span class="close clickable" onclick="closePanel(this)" panename="result1d30d4ed">×</span>
</div>
<iframe class="fileview" id="result1d30d4ed-body"></iframe>
</div>
</div>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_html"><b> &gt; to track results use the .show() or .logs() methods  or <a href="https://dashboard.default-tenant.app.llm2.iguazio-cd0.com/mlprojects/pii/jobs/monitor/3f6d701e423346b39026dc365698c15c/overview" target="_blank">click here</a> to open in UI</b></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 2023-07-31 02:23:06,096 [info] Run execution finished: {'status': 'completed', 'name': 'pii-recognizer-recognize-pii'}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the mlrun context</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_or_create_ctx</span><span class="p">(</span><span class="s1">'pii_ctx'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="n">tqdm</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">"./data/output3/"</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.txt"</span><span class="p">)),</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">"Processing files"</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">"file"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">):</span>
            <span class="c1"># Load the str from the text file</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">txt_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f478b2a3792e42beabad632b9523e169", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dear Mr. John Doe,

We are pleased to inform you that you have been selected as the winner of our exclusive vacation package giveaway!
John smith's Company XYZ is 182838483, connect him with 😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀😀 or 3990096a212e92850c3b3c8e57ab398252d482444a32def6b030cbac2d51efa3, he can pay you with a6983d9477e93eab115305afd124bd096699e6cb7d2ce72ec6e29a6378a4e8059393
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check the highlighted html </span>
<span class="n">html_output</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_cached_artifact</span><span class="p">(</span><span class="s2">"highlighted"</span><span class="p">)</span>
<span class="n">html_str</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_dataitem</span><span class="p">(</span><span class="n">html_output</span><span class="o">.</span><span class="n">get_target_path</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_str</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><html><head><title>Highlighted Pii Entities</title></head><body><h1>Highlighted Pii Entities</h1><ul><li><a href="#data/letter.txt">data/letter.txt</a></li><li><a href="#data/pii_data.txt">data/pii_data.txt</a></li></ul><li><h2>data/letter.txt</h2><p><p><span><span>Dear Mr. <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John Doe<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span></span><span>,

We are pleased to inform you that you have been selected as the winner of our exclusive vacation package giveaway! Congratulations! You, along with your family, will enjoy a luxurious stay at our resort in the beautiful city of <span style="display:inline-flex;flex-direction:row;align-items:center;background:#803df566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">Riviera<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">LOCATION</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">Riviera<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span></span></span></p></p></li><li><h2>data/pii_data.txt</h2><p><p><span><span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John smith's<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span> <span style="display:inline-flex;flex-direction:row;align-items:center;background:#80849566;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">ssn<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">ORGANIZATION</span></span> is 182838483, connect him with <span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#ff4b4b33;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">John_smith@gmail.com<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">EMAIL</span></span><span style="display:inline-flex;flex-direction:row;align-items:center;background:#21c35466;border-radius:0.5rem;padding:0.25rem 0.5rem;overflow:hidden;line-height:1">smith<span style="border-left:1px solid;opacity:0.1;margin-left:0.5rem;align-self:stretch"></span><span style="margin-left:0.5rem;font-size:0.75rem;opacity:0.5">PERSON</span></span></span></span></p></p></li></body></html></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check the json report about the explanation.</span>
<span class="n">rpt_output</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_cached_artifact</span><span class="p">(</span><span class="s2">"rpt_json"</span><span class="p">)</span>
<span class="n">rpt_str</span> <span class="o">=</span> <span class="n">mlrun</span><span class="o">.</span><span class="n">get_dataitem</span><span class="p">(</span><span class="n">rpt_output</span><span class="o">.</span><span class="n">get_target_path</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rpt_str</span><span class="p">)</span>
 
<span class="c1"># Pretty Print JSON</span>
<span class="n">json_formatted_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json_formatted_str</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    "data/letter.txt": [
        {
            "entity_type": "PERSON",
            "start": 9,
            "end": 17,
            "score": 1
        },
        {
            "entity_type": "LOCATION",
            "start": 248,
            "end": 255,
            "score": 1.0
        },
        {
            "entity_type": "ORGANIZATION",
            "start": 248,
            "end": 255,
            "score": 1
        }
    ],
    "data/pii_data.txt": [
        {
            "entity_type": "PERSON",
            "start": 0,
            "end": 12,
            "score": 1
        },
        {
            "entity_type": "ORGANIZATION",
            "start": 13,
            "end": 16,
            "score": 1
        },
        {
            "entity_type": "PERSON",
            "start": 53,
            "end": 58,
            "score": 1.0
        },
        {
            "entity_type": "PERSON",
            "start": 48,
            "end": 52,
            "score": 0.87
        },
        {
            "entity_type": "EMAIL",
            "start": 48,
            "end": 68,
            "score": 0.5
        },
        {
            "entity_type": "PHONE",
            "start": 72,
            "end": 82,
            "score": 0.5
        },
        {
            "entity_type": "PHONE",
            "start": 104,
            "end": 114,
            "score": 0.5
        }
    ]
}
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
      © Copyright .<br/>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>